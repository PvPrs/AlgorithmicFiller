/* ************************************************************************** */
/*                                                                            */
/*                                                        ::::::::            */
/*   map_gen.c                                          :+:    :+:            */
/*                                                     +:+                    */
/*   By: dvan-boc <marvin@codam.nl>                   +#+                     */
/*                                                   +#+                      */
/*   Created: 2020/01/15 11:26:06 by dvan-boc      #+#    #+#                 */
/*   Updated: 2020/01/15 11:26:07 by dvan-boc      ########   odam.nl         */
/*                                                                            */
/* ************************************************************************** */

/*
** The Virtual Machine 'filler_vm'
** Prints the map upon starting the project.
** Prints players 'token' on every turn.
*/

#include "../libft/includes/libft.h"
#include "../includes/filler.h"

#define stdout 0

/*
** Allocates a linear allocated memory area to store the map.
** @param map Represents a pointer to a linear allocated 2D Array.
** @param col Represents the column size.
** @param row Represents the line size.
** @return
*/
static char	*alloc_map(char *map, int height, int width)
{
	map = malloc(sizeof(char[height][width]));
	if (!map)
		return (NULL);
	map[width] = NULL;
	return (map);
}

/*
** Reads file contents
 * @param map represents a pointer to a specific element to assign to.
** @param identifier represents the a phrase to look for, i.e. "Plateau ", or "piece ".
** @param delimiter represents a space in both cases.
** @param len for strncmp
** @param readType: 0 = Read Map, 1 = Read Token.
** @return A pointer to the read map;
** { Expression statements are within scope }
**/
static char	*read_stdout(char *map, char *identifier, char delimiter, int len)
{
	char	*line;
	int		col;
	int		row;

	while (get_next_line(stdout, &line))
	{
		if (ft_strncmp(line, identifier, len))
		{
			while (*line != ':')
			{
				*line == delimiter && row == 0 ? row : col = {
						ft_atoi(line);
				};
				line++;
			}
		}
	}
	if (identifier == "Plateau" || identifier == "Piece")
		map = alloc_map(map, row col);
	return (init_output(map, line, row, col));
}

/**
**
** Initializes the information read from @stdout
** to the right variable, both Map & Piece.
** @param map A pointer to a 2D Array
** @param line Represents a pointer the current position
** @param row represents the row size
** @param col represents the col size
** @return a pointer to a 2D Array generated by alloc_map
*/
static char	*init_output(char *map, char *line, int row, int col)
{
	int index;

	index = 0;
	while (get_next_line(stdout, &line))
	{
		while (index != col)
		{
			while (line)
			{
				if (*line == ('.' || 'O' || 'X' || 'o' || 'x' || '*'))
					ft_strcpy(*map[index], line);
				else
					line++;
			}
			index++;
		}
	}
	return (map);
}

/**
 * encapsulates the read_stdout function
 * and returns a game_map read from 'Standard Output'
 * @return a Filled game_map
 */
char		*get_map(char *map)
{
	return (read_stdout(map, "Plateau", ' ', 8))
}

/**
 * encapsulates the read_stdout function
 * and returns a game_piece read from 'Standard Output'
 * @return a Filled game_piece
 */
char		*get_piece(char *piece)
{
	return (read_stdout(piece, "Piece", ' ', 5));
}
